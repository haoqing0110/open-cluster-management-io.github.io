<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"/>
  <link rel="stylesheet" href="/main.css"/>
  <link rel="shortcut icon" type="image/svg" href="/ocm.svg">
  <title>Open Cluster Management</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1PXKZXT157"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1PXKZXT157');
  </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">




<input id="current-lang" type="hidden" value="en">

<header class="navbar navbar-expand-lg navbar-dark bd-navbar">
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container-fluid flex-wrap flex-lg-nowrap">
      <a href="/" class="navbar-brand">
        <img src="/ocm.svg" alt="" width="30" height="24" class="align-text-top">
        <span>Open Cluster Management</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item pe-2">
            <a href="/community" class="nav-link text-light">Community</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/contribute" class="nav-link text-light">Contribute</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/concepts" class="nav-link text-light">Document</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/blog" class="nav-link text-light">Blog</a>
          </li>
          <li class="nav-item dropdown pe-2">
            
            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">English</a>
            

            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              
              <li><a class="dropdown-item" href="#" id="to-zh">中文</a></li>
              
            </ul>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank" aria-label="youtube">
                <i class="bi bi-youtube"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://github.com/open-cluster-management-io" target="_blank" aria-label="github">
              <i class="bi bi-github"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank" aria-label="slack">
              <i class="bi bi-slack"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
</div>
        <div class="row subject-padding">
            <div class="col-lg-2 col-md-3 padding-none sidebar-bgc">




<div class="sidebar-toggle sidebar-toggle-sm">
    <button type="button" id="sidebarToggle" class="btn btn-info">
        <i class="bi bi-list"></i>
    </button>
</div>
<nav id="sidebar" class="sidebar-hide-sm">
    <ul class="components">
        <li id="concepts">
            <a class="navlink" href="/concepts">Concepts</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/concepts/architecture">Architecture</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/clusterclaim">ClusterClaim</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedcluster">ManagedCluster</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/managedclusterset">ManagedClusterSet</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/placement">Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/manifestwork">ManifestWork</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/manifestworkreplicaset">ManifestWorkReplicaSet</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/addon">Add-ons</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/policy">Policy</a>
                </li>
                <li>
                    <a class="navlink" href="/concepts/multicluster-controlplane">Multicluster Control Plane</a>
                </li>
            </ul>
        </li>
        <li id="getting-started">
            <a class="navlink" href="/getting-started">Getting Started</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/getting-started/quick-start">Quick Start</a>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/installation">Installation</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/getting-started/installation/start-the-control-plane">Start the Control Plane</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/installation/register-a-cluster">Register a Cluster</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/integration">Add-ons and Integrations</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/getting-started/integration/app-lifecycle">Application lifecycle management</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/cluster-proxy">Cluster proxy</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-framework">Policy framework</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/policy-controllers">Policy controllers</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/integration/managed-serviceaccount">Managed service account</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/getting-started/administration">Administration</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/getting-started/administration/upgrading">Upgrading</a>
                        </li>
                        <li>
                            <a class="navlink" href="/getting-started/administration/monitoring">Monitoring</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li id="developer-guides">
            <a class="navlink" href="/developer-guides">Developer Guides</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/developer-guides/addon">Add-on Developer Guide</a>
                </li>
                <li>
                    <a class="navlink" href="/developer-guides/vscode-extension">VScode Extension</a>
                </li>
            </ul>
        </li>
        <li id="scenarios">
            <a class="navlink" href="/scenarios">Scenarios</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/scenarios/deploy-kubernetes-resources">Deploy Kubernetes Resources</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/distribute-workload-with-placement">Distribute Workload With Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/migrate-workload-with-placement">Migrate Workload With Placement</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extend-multicluster-scheduling-capabilities">Extend Multicluster Scheduling Capabilities</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/extending-managed-clusters">Extend Managed Clusters</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/integration-with-argocd">Integration with Argo CD</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/manage-cluster-with-multiple-hubs">Manage a cluster with multiple hubs</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/pushing-kube-api-requests">Pushing Kube API Requests to the Managed Clusters</a>
                </li>
                <li>
                    <a class="navlink" href="/scenarios/register-cluster-through-proxy">Register a cluster to hub through proxy server</a>
                </li>
            </ul>
        </li>
        <li id="community">
            <a class="navlink" href="/community">Community</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/community/releases">Releases</a>
                </li>
                <li >
                    <a class="navlink" href="/community/roadmap">Roadmap</a>
                </li>
            </ul>
        </li>
        <li id="contribute">
            <a class="navlink" href="/contribute">Contribute</a>
        </li>
        <li id="blog">
            <a class="navlink" href="/blog">Blog</a>
        </li>
        <li style="padding-top: 10px; border-top: 2px solid #448a78;">
            <a class="navlink resource" href="https://github.com/open-cluster-management-io" target="_blank"><i class="bi bi-github"></i><span style="padding-left: 10px;">GitHub</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank"><i class="bi bi-slack"></i><span style="padding-left: 10px;">Slack</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank"><i class="bi bi-youtube"></i><span style="padding-left: 10px;">YouTube</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://groups.google.com/g/open-cluster-management" target="_blank"><i class="bi bi-envelope-fill"></i><span style="padding-left: 10px;">Mailing group</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" target="_blank"><i class="bi bi-calendar-event-fill"></i><span style="padding-left: 10px;">Community meetings</span></a>
        </li>
    </ul>
</nav>
<script type="text/javascript" src="/sidebar.js"></script>
</div>
            <div class="col-lg-10 col-md-9 padding-none">
<div id="content">
    <h1>Using the GitOps way to deal with the upgrade challenges of multi-cluster tool chains</h1>
    <p>January 19, 2024 <a href="https://github.com/haoqing0110">Hao Qing</a></p>



  <div class="gdoc-toc gdoc-toc__level--6"><nav id="TableOfContents"><ul>
        <li><a href="#upgrading-challenges-of-tool-chains-in-multi-cluster-environments">Upgrading challenges of tool chains in multi-cluster environments</a></li>
        <li><a href="#add-on">Add-on</a></li>
        <li><a href="#placement-decision-strategy">Placement Decision Strategy</a></li>
        <li><a href="#simplify-upgrades-the-gitops-way">Simplify upgrades the GitOps way</a></li>
        <li><a href="#three-upgrade-strategies">Three upgrade strategies</a></li>
        <li><a href="#three-upgrade-configurations">Three upgrade configurations</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul></nav><hr></div>


<h2 id="upgrading-challenges-of-tool-chains-in-multi-cluster-environments">Upgrading challenges of tool chains in multi-cluster environments</h2>
<p>Open Cluster Management (OCM) is a community-driven project focused on multicluster and multicloud scenarios for Kubernetes applications. It provides functions such as cluster registration, application and workload distribution, and scheduling. Add-on is an extension mechanism based on the foundation components provided by OCM, which allows applications in the Kubernetes ecosystem to be easily migrated to the OCM platform and has the ability to orchestrate and schedule across multiple clusters and multiple clouds. For example, Istio, Prometheus, and Submarine can be expanded to multiple clusters through Add-on. In a multi-cluster environment, how to upgrade the entire tool chain (such as Istio, Prometheus and other tools) gracefully and smoothly is a challenge we encounter in multi-cluster management. A failed upgrade of the tool chain can potentially render thousands of user workloads inaccessible. Therefore, finding an easy and safe upgrade solution across clusters becomes important.</p>
<p>In this article, we will introduce how Open Cluster Management (OCM) treats tool chain upgrades as configuration file changes, allowing users to leverage Kustomize or GitOps to achieve seamless rolling/canary upgrades across clusters.</p>
<p>Before we begin, let us first introduce several concepts in OCM.</p>
<h2 id="add-on">Add-on</h2>
<p>On the OCM platform, add-on can apply different configurations on different managed clusters, and can also implement functions such as obtaining data from the control plane (Hub) to the managed cluster. For example, you can use <a href="https://github.com/open-cluster-management-io/managed-serviceaccount">managed-serviceaccount</a>, this add-on returns the specified <code>ServiceAccount</code> information on the managed cluster to the hub cluster. You can use the <a href="https://github.com/open-cluster-management-io/cluster-proxy">cluster-proxy</a> add-on to establish a reverse proxy channel from spoke to hub.</p>
<p>At this stage, there are some add-ons in the OCM community:</p>
<ul>
<li><a href="https://github.com/open-cluster-management-io/multicluster-mesh">Multicluster Mesh Addon</a> can be used to manage (discovery, deploy and federate) service meshes across multiple clusters in OCM.</li>
<li><a href="https://github.com/stolostron/submariner-addon">Submarine Addon</a> deploys the Submariner Broker on the Hub cluster and the required Submariner components on the managed clusters.</li>
<li><a href="https://github.com/open-cluster-management-io/addon-contrib/tree/main/open-telemetry-addon">Open-telemetry add-on</a> automates the installation of otelCollector on both hub cluster and managed clusters and jaeget-all-in-one on hub cluster for processing and storing the traces.</li>
<li><a href="https://open-cluster-management.io/zh/getting-started/integration/app-lifecycle/">Application lifecycle management</a> enables application lifecycle management in multi-cluster or multi-cloud environments.</li>
<li><a href="https://open-cluster-management.io/getting-started/integration/policy-framework/">Policy framework</a> and <a href="https://open-cluster-management.io/getting-started/integration/policy-controllers/">Policy controllers</a> allows Hub cluster administrators to easily deploy security-related policies for managed clusters.</li>
<li><a href="https://open-cluster-management.io/getting-started/integration/managed-serviceaccount/">Managed service account</a> enables a hub cluster admin to manage service account across multiple clusters on ease.</li>
<li><a href="https://open-cluster-management.io/getting-started/integration/cluster-proxy/">Cluster proxy</a> provides L4 network connectivity from hub cluster to the managed clusters.</li>
</ul>
<p><strong>For more information about add-on, please refer to <a href="https://open-cluster-management.io/concepts/addon/">Add-on concept</a> and <a href="https://open-cluster-management.io/developer-guides/addon/">Add-on Developer Guide</a>.</strong></p>
<p>OCM provides two ways to help developers develop their own add-ons:</p>
<ul>
<li>Hard mode: Using the built-in mechanism of <a href="https://github.com/open-cluster-management-io/addon-framework">addon-framework</a>, you can follow the <a href="https://open-cluster-management.io/developer-guides/addon/">Add-on Development Guide</a> to develop the addon manager and addon agent.</li>
<li>Easy mode: OCM provides a new development model, which can use <a href="https://open-cluster-management.io/developer-guides/addon/#build-an-addon-with-addon-template">AddOnTemplate</a> to build add-on. In this model, developers do not need to develop the addon manager, but only need to prepare the addon agent&rsquo;s image and <code>AddOnTemplate</code>. <code>AddOnTemplate</code> describes how to deploy the addon agent and how to register the add-on.</li>
</ul>
<p>Below is the <code>ClusterManagementAddOn</code> and <code>AddOnTemplate</code> of a sample add-on. <code>AddOnTemplate</code> is treated as an add-on configuration file, defined in <code>supportedConfigs</code>. The <code>AddOnTemplate</code> resource contains the manifest required to deploy the add-on and the add-on registration method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterManagementAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hello-template</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">addOnMeta</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">description</span>: <span style="color:#ae81ff">hello-template is an addon built with addon template</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">displayName</span>: <span style="color:#ae81ff">hello-template</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">supportedConfigs</span>: <span style="color:#75715e"># declare it is a template type addon</span>
</span></span><span style="display:flex;"><span>   - <span style="color:#f92672">group</span>: <span style="color:#ae81ff">addon.open-cluster-management.io</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">resource</span>: <span style="color:#ae81ff">addontemplates</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">defaultConfig</span>:
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hello-template</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">AddOnTemplate</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hello-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">addonName</span>: <span style="color:#ae81ff">hello-template</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">agentSpec</span>: <span style="color:#75715e">#required</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">workload</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">manifests</span>:
</span></span><span style="display:flex;"><span>           - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>               <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hello-template-agent</span>
</span></span><span style="display:flex;"><span>               <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">open-cluster-management-agent-addon</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>           - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>               <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hello-template-agent-sa</span>
</span></span><span style="display:flex;"><span>               <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">open-cluster-management-agent-addon</span>
</span></span><span style="display:flex;"><span>           - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hello-template-agent</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">registration</span>: <span style="color:#75715e">#optional</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ae81ff">...</span>
</span></span></code></pre></div><h2 id="placement-decision-strategy">Placement Decision Strategy</h2>
<p>The Placement API is used to select a set of <code>ManagedClusters</code> in one or more <code>ManagedClusterSets</code> to deploy workloads to these clusters.</p>
<p><strong>For more introduction to the Placement API, please refer to <a href="https://open-cluster-management.io/concepts/placement/">Placement concept</a>.</strong></p>
<p>The &ldquo;input&rdquo; and &ldquo;output&rdquo; of the Placement scheduling process are decoupled into two independent Kubernetes APIs: <code>Placement</code> and <code>PlacementDecision</code>.</p>
<ul>
<li>Placement provides filtering of clusters through the <code>labelSelector</code> or the <code>claimSelector</code>, and also provides some built-in <code>prioritizers</code>, which can score, sort and prioritize the filtered clusters.</li>
<li>The scheduling results of <code>Placement</code> will be placed in <code>PlacementDecision</code>, <code>status.decisions</code> lists the top N clusters with the highest scores and sorts them by name, and the scheduling results will dynamically change as the cluster changes. The <code>decisionStrategy</code> section in Placement can be used to divide the created <code>PlacementDecision</code> into multiple groups and define the number of clusters in each decision group. <code>PlacementDecision</code> supports paging display, and each resource supports containing 100 cluster names.</li>
</ul>
<p>Below is an example of <code>Placement</code> and <code>decisionStrategy</code>. Assume that there are 300 <code>ManagedClusters</code> in the global <code>ManagedClusterSets</code>, and 10 of them have the label canary. The following example describes grouping the canary-labeled clusters into a group and grouping the remaining clusters into groups of up to 150 clusters each.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">cluster.open-cluster-management.io/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Placement</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placement</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">clusterSets</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">global</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">decisionStrategy</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">groupStrategy</span>:
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">clustersPerDecisionGroup</span>: <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">decisionGroups</span>:
</span></span><span style="display:flex;"><span>       - <span style="color:#f92672">groupName</span>: <span style="color:#ae81ff">canary</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">groupClusterSelector</span>:
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">labelSelector</span>:
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>               - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">canary</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">Exists</span>
</span></span></code></pre></div><p>The grouped results will be displayed in the <code>status</code> of <code>Placement</code>. The canary group has 10 clusters, and the results are placed in <code>aws-placement-decision-1</code>. The other default groupings are only group index, each group has 150 and 140 clusters respectively. Since a <code>PlacementDecsion</code> only supports 100 clusters, the results for each group are put into two <code>PlacementDecisions</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">status</span>:
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">decisionGroups</span>:
</span></span><span style="display:flex;"><span>   - <span style="color:#f92672">clusterCount</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">decisionGroupIndex</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">decisionGroupName</span>: <span style="color:#ae81ff">canary</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">decisions</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">aws-placement-decision-1</span>
</span></span><span style="display:flex;"><span>   - <span style="color:#f92672">clusterCount</span>: <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">decisionGroupIndex</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">decisionGroupName</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">decisions</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">aws-placement-decision-2</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">aws-placement-decision-3</span>
</span></span><span style="display:flex;"><span>   - <span style="color:#f92672">clusterCount</span>: <span style="color:#ae81ff">140</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">decisionGroupIndex</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">decisionGroupName</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">decisions</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">placement1-decision-3</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#ae81ff">placement1-decision-4</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">numberOfSelectedClusters</span>: <span style="color:#ae81ff">300</span>
</span></span></code></pre></div><p>Taking the canary group as an example, its <code>PlacementDecision</code> is as follows, where the label <code>cluster.open-cluster-management.io/decision-group-index</code> represents the index of the group to which it belongs, <code>cluster.open-cluster-management.io/decision-group-name</code> represents the name of the group it belongs to, and <code>cluster.open-cluster-management.io/placement</code> represents the <code>Placement</code> it belongs to. Users can flexibly obtain scheduling results through tag selectors.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">cluster.open-cluster-management.io/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PlacementDecision</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">cluster.open-cluster-management.io/decision-group-index</span>: <span style="color:#e6db74">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">cluster.open-cluster-management.io/decision-group-name</span>: <span style="color:#ae81ff">canary</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">cluster.open-cluster-management.io/placement</span>: <span style="color:#ae81ff">aws-placement</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placement-decision-1</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">status</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">decisions</span>:
</span></span><span style="display:flex;"><span>   - <span style="color:#f92672">clusterName</span>: <span style="color:#ae81ff">cluster1</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">reason</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>   - <span style="color:#f92672">clusterName</span>: <span style="color:#ae81ff">cluster10</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">reason</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span></code></pre></div><h2 id="simplify-upgrades-the-gitops-way">Simplify upgrades the GitOps way</h2>
<p>The above briefly introduces the concepts of add-on template and placement decision strategy.</p>
<p>In OCM, we regard the upgrade of add-on as the upgrade of its configuration file. The configuration here can be <code>AddOnTemplate</code> or other customized configuration file such as <code>AddOnDeploymentConfig</code>. An add-on upgrade is treated as a configuration file update, which enables users to leverage Kustomize or GitOps for seamless cross-cluster rolling/canary upgrades. <code>RolloutStrategy</code> defines the upgrade strategy, supports upgrade all, progressive upgrades by cluster and progressive upgrades by cluster group, and can define a set of <code>MandatoryDecisionGroups</code> to try new configurations first.</p>
<p>According to the four principles of GitOps, let&rsquo;s take a look at how OCM supports the GitOps approach to address upgrade challenges in multi-cluster environments.</p>
<ul>
<li>Declarative</li>
</ul>
<p>The configuration file used by add-on can be declared in <code>ClusterManagementAddOn</code>. The configuration file can be declared in the global <code>supportedConfigs</code>, and the configuration file will be applied to all <code>ManagedClusterAddOn</code> instances. It can also be declared in different placements under <code>installStrategy</code>. The <code>ManagedClusterAddOn</code> of the cluster selected by each Placement will have the same configuration file. The configuration declared in placements will override the global configuration.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterManagementAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">supportedConfigs</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">defaultConfig</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-0.4.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">group</span>: <span style="color:#ae81ff">addon.open-cluster-management.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resource</span>: <span style="color:#ae81ff">addontemplates</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">installStrategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">placements</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placement</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">configs</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">group</span>: <span style="color:#ae81ff">addon.open-cluster-management.io</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resource</span>: <span style="color:#ae81ff">addondeploymentconfigs</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-addon-deploy-config</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">rolloutStrategy</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Progressive</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">progressive</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mandatoryDecisionGroups</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">maxConcurrency</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Placements</span>
</span></span></code></pre></div><ul>
<li>Version control</li>
</ul>
<p>Changes in the add-on configuration file name or spec content will be considered a configuration change and will trigger an upgrade of the add-on. Users can leverage Kustomize or GitOps to control configuration file upgrades.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">AddOnTemplate</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-0.4.0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">agentSpec</span>: <span style="color:#75715e"># required</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">workload</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">manifests</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-addon-agent</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">open-cluster-management-agent-addon</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">open-cluster-management-agent-addon</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">…</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">registration</span>: <span style="color:#75715e"># optional</span>
</span></span></code></pre></div><ul>
<li>Automation</li>
</ul>
<p>The OCM component addon-manager-controller under the open-cluster-management-hub namespace is a more general addon manager. It will watch the following two types of add-on and be responsible for maintaining the lifecycle of such add-on. Includes installation and upgrades. When the name or spec content of the configuration file changes, this component will upgrade the add-on according to the upgrade strategy defined by rolloutStrategy.</p>
<ul>
<li>Hard mode: Using the add-on developed by the latest <a href="https://github.com/open-cluster-management-io/addon-framework">addon-framework</a>, you need to delete the <code>WithInstallStrategy()</code> method in the code and add annotation <code>addon.open-cluster-management.io/lifecycle: &quot;addon-manager&quot;</code> in <code>ClusterManagementAddOn</code>. For details, refer to <a href="https://open-cluster-management.io/developer-guides/addon/#managing-the-add-on-agent-lifecycle-by-addon-manager">Add-on Development Guide</a>.</li>
<li>Easy mode: add-on developed using <code>AddOnTemplate</code> mode.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>✗ kubectl get deploy -n open-cluster-management-hub
</span></span><span style="display:flex;"><span>NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>cluster-manager-addon-manager-controller   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           10h
</span></span><span style="display:flex;"><span>cluster-manager-placement-controller       1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           10h
</span></span><span style="display:flex;"><span>cluster-manager-registration-controller    1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           10h
</span></span><span style="display:flex;"><span>cluster-manager-registration-webhook       1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           10h
</span></span><span style="display:flex;"><span>cluster-manager-work-webhook               1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           10h
</span></span></code></pre></div><ul>
<li>Coordination</li>
</ul>
<p>The spec hash of the add-on configuration file will be recorded in the status of <code>ClusterManagementAddOn</code> and <code>ManagedClusterAddOn</code>. When the spec hash changes, add-on-manager-controller will continue to update the add-on according to the upgrade strategy defined by rolloutStrategy until <code>lastAppliedConfig</code>, <code>lastKnownGoodConfig</code> is consistent with <code>desiredConfig</code>. In the following example, because <code>lastAppliedConfig</code> does not match <code>desiredConfig</code>, the add-on status is displayed as &ldquo;Upgrading&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterManagementAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">…</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">status</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">installProgressions</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">lastTransitionTime</span>: <span style="color:#e6db74">&#34;2023-09-21T06:53:59Z&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">message</span>: <span style="color:#ae81ff">1</span><span style="color:#ae81ff">/3 upgrading, 0 timeout.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">reason</span>: <span style="color:#ae81ff">Upgrading</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">status</span>: <span style="color:#e6db74">&#34;False&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Progressing</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">configReferences</span>:
</span></span><span style="display:flex;"><span>       - <span style="color:#f92672">desiredConfig</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-0.4.1</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">specHash</span>: <span style="color:#ae81ff">dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">group</span>: <span style="color:#ae81ff">addon.open-cluster-management.io</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">lastAppliedConfig</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-0.4.0</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">specHash</span>: <span style="color:#ae81ff">1f7874ac272f3e4266f89a250d8a76f0ac1c6a4d63d18e7dcbad9068523cf187</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">lastKnownGoodConfig</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-0.4.0</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">specHash</span>: <span style="color:#ae81ff">1f7874ac272f3e4266f89a250d8a76f0ac1c6a4d63d18e7dcbad9068523cf187</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resource</span>: <span style="color:#ae81ff">addontemplates</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placementl</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ManagedClusterAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">cluster1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">…</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">status</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">lastTransitionTime</span>: <span style="color:#e6db74">&#34;2023-09-21T06:53:42Z&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">message</span>: <span style="color:#ae81ff">upgrading.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">reason</span>: <span style="color:#ae81ff">Upgrading</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">status</span>: <span style="color:#e6db74">&#34;False&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Progressing</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">configReferences</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">desiredConfig</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-0.4.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">specHash</span>: <span style="color:#ae81ff">dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">group</span>: <span style="color:#ae81ff">addon.open-cluster-management.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lastAppliedConfig</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-0.4.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">specHash</span>: <span style="color:#ae81ff">dcf88f5b11bd191ed2f886675f967684da8b5bcbe6902458f672277d469e2044</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lastObservedGeneration</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-0.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resource</span>: <span style="color:#ae81ff">addontemplates</span>
</span></span></code></pre></div><h2 id="three-upgrade-strategies">Three upgrade strategies</h2>
<p>The <code>rolloutStrategy</code> field of <code>ClusterManagementAddOn</code> defines the upgrade strategy. Currently, OCM supports three types of upgrade strategies.</p>
<ul>
<li>All</li>
</ul>
<p>The default upgrade type is All, which means the new configuration file will be applied to all the clusters immediately.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterManagementAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">supportedConfigs</span>:
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">installStrategy</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">placements</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placement</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">namespace:default</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">rolloutStrategy</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">type</span>: <span style="color:#ae81ff">All</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Placement</span>
</span></span></code></pre></div><ul>
<li>Progressive</li>
</ul>
<p>Progressive means that the new configuration file will be deployed to the selected clusters progressively per cluster. The new configuration file will not be applied to the next cluster unless one of the current applied clusters reach the successful state and haven&rsquo;t breached the <code>MaxFailures</code>. We introduced the concept of &ldquo;Placement Decision Group&rdquo; earlier. One or more decision groups can be specified in <code>MandatoryDecisionGroups</code>. If <code>MandatoryDecisionGroups</code> are defined, new configuration files are deployed to these cluster groups first. <code>MaxConcurrency</code> defines the maximum number of clusters deployed simultaneously.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterManagementAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">supportedConfigs</span>:
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">installStrategy</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">placements</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placement</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">namespace:default</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">rolloutStrategy</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Progressive</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">progressive</span>:
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">mandatoryDecisionGroups</span>:
</span></span><span style="display:flex;"><span>           - <span style="color:#f92672">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">maxConcurrency</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Placements</span>
</span></span></code></pre></div><ul>
<li>ProgressivePerGroup</li>
</ul>
<p>ProgressivePerGroup means that the new configuration file will be deployed to decisionGroup clusters progressively per group. The new configuration file will not be applied to the next cluster group unless all the clusters in the current group reach the successful state and haven&rsquo;t breached the <code>MaxFailures</code>. If <code>MandatoryDecisionGroups</code> are defined, new configuration files are deployed to these cluster groups first. If there are no <code>MandatoryDecisionGroups</code>, the cluster group will be upgraded in order of index.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterManagementAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">supportedConfigs</span>:
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">installStrategy</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">placements</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placement</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">namespace:default</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">rolloutStrategy</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ProgressivePerGroup</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">progressivePerGroup</span>:
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">mandatoryDecisionGroups</span>:
</span></span><span style="display:flex;"><span>           - <span style="color:#f92672">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Placements</span>
</span></span></code></pre></div><p>According to the four principles of GitOps and the three upgrade strategies of OCM, users can use Kustomize or GitOps to achieve seamless rolling/canary upgrades across clusters. It is worth noting that installStrategy supports multiple placement definitions, and users can implement more advanced upgrade strategies based on this.</p>
<p>As in the example below, you can define two placements at the same time to select clusters on aws and gcp respectively, so that the same add-on can use different configuration files and upgrade strategies in different clusters.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterManagementAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">supportedConfigs</span>:
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">installStrategy</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">placements</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placement</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">configs</span>:
</span></span><span style="display:flex;"><span>       - <span style="color:#f92672">group</span>: <span style="color:#ae81ff">addon.open-cluster-management.io</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">resource</span>: <span style="color:#ae81ff">addondeploymentconfigs</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-addon-deploy-config-aws</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">rolloutStrategy</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ProgressivePerGroup</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">progressivePerGroup</span>:
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">mandatoryDecisionGroups</span>:
</span></span><span style="display:flex;"><span>           - <span style="color:#f92672">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Placements</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gcp-placement</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">configs</span>:
</span></span><span style="display:flex;"><span>       - <span style="color:#f92672">group</span>: <span style="color:#ae81ff">addon.open-cluster-management.io</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">resource</span>: <span style="color:#ae81ff">addondeploymentconfigs</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount-addon-deploy-config-gcp</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">rolloutStrategy</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ProgressivePerGroup</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">progressivePerGroup</span>:
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">mandatoryDecisionGroups</span>:
</span></span><span style="display:flex;"><span>           - <span style="color:#f92672">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Placements</span>
</span></span></code></pre></div><h2 id="three-upgrade-configurations">Three upgrade configurations</h2>
<p>The <code>rolloutStrategy</code> upgrade strategy can also define <code>MinSuccessTime</code>, <code>ProgressDeadline</code> and <code>MaxFailures</code> to achieve more fine-grained upgrade configuration.</p>
<ul>
<li>MinSuccessTime</li>
</ul>
<p><code>MinSuccessTime</code> defines how long the controller needs to wait before continuing to upgrade the next cluster when the addon upgrade is successful and <code>MaxFailures</code> is not reached. The default value is 0 meaning the controller proceeds immediately after a successful state is reached.</p>
<p>In the following example, add-on will be upgraded at a rate of one cluster every 5 minutes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterManagementAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">supportedConfigs</span>:
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">installStrategy</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">placements</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placement</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">rolloutStrategy</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Progressive</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">progressive</span>:
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">mandatoryDecisionGroups</span>:
</span></span><span style="display:flex;"><span>           - <span style="color:#f92672">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">maxConcurrency</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">minSuccessTime</span>: <span style="color:#e6db74">&#34;5m&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Placements</span>
</span></span></code></pre></div><ul>
<li>ProgressDeadline</li>
</ul>
<p><code>ProgressDeadline</code> defines the maximum time for the controller to wait for the add-on upgrade to be successful. If the add-on does not reach a successful state after <code>ProgressDeadline</code>, controller will stop waiting and this cluster will be treated as &ldquo;timeout&rdquo; and be counted into <code>MaxFailures</code>. Once the <code>MaxFailures</code> is breached, the rollout will stop. The default value is &ldquo;None&rdquo;, which means the controller will wait for a successful state indefinitely.</p>
<p>In the following example, the controller will wait for 10 minutes on each cluster until the addon upgrade is successful. If it fails after 10 minutes, the upgrade status of the cluster will be marked as &ldquo;timeout&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterManagementAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">supportedConfigs</span>:
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">installStrategy</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">placements</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placement</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">namespace:default</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">rolloutStrategy</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Progressive</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">progressive</span>:
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">mandatoryDecisionGroups</span>:
</span></span><span style="display:flex;"><span>           - <span style="color:#f92672">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">maxConcurrency</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">progressDeadline</span>: <span style="color:#e6db74">&#34;10m&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Placements</span>
</span></span></code></pre></div><ul>
<li>MaxFailures</li>
</ul>
<p><code>MaxFailures</code> defines the number of clusters that can tolerate upgrade failures, which can be a numerical value or a percentage. If the cluster status is failed or timeout, it will be regarded as an upgrade failure. If the failed cluster exceeds <code>MaxFailures</code>, the upgrade will stop.</p>
<p>In the following example, when 3 addons fail to upgrade or does not reach successful status for more than 10 minutes, the upgrade will stop.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">addon.open-cluster-management.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterManagementAddOn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">managed-serviceaccount</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">addon.open-cluster-management.io/lifecycle</span>: <span style="color:#e6db74">&#34;addon-manager&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">supportedConfigs</span>:
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">installStrategy</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">placements</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">aws-placement</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">rolloutStrategy</span>:
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Progressive</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">progressive</span>:
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">mandatoryDecisionGroups</span>:
</span></span><span style="display:flex;"><span>           - <span style="color:#f92672">groupName</span>: <span style="color:#e6db74">&#34;canary&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">maxConcurrency</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">maxFailures</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">progressDeadline</span>: <span style="color:#e6db74">&#34;10m&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Placements</span>
</span></span></code></pre></div><h2 id="summary">Summary</h2>
<p>This article details how to use Open Cluster Management to address tool chain upgrade challenges in a multi-cluster environment using the GitOps way. OCM provides a Kubernetes-based management platform across multiple clusters and multiple clouds. Through Add-on and Placement API, users can upgrade the entire tool chain gracefully and smoothly. At the same time, OCM treats add-on upgrades as configuration file changes, enabling users to leverage Kustomize or GitOps for seamless rolling/canary upgrades across clusters. In addition, OCM also provides a variety of upgrade strategies, including all upgrade (All), progressive upgrade by cluster (Progressive) and progressive upgrade by cluster group (ProgressivePerGroup) to meet different upgrade needs.</p>

</div>
<script type="text/javascript" src="/clipboard-copy.js"></script>
</div>
        </div>
        <div class="row"><nav class="ocm navbar navbar-expand-lg navbar-dark py-3">
  <div class="container-fluid flex-wrap flex-md-nowrap">
    <div class="text-light">&copy; 2024 Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank" style="color: #f8f9fa;">Trademark Usage</a></div>
  </div>
</nav>
<script type="text/javascript" src="/lang.js"></script>
</div>
    </div>
</body>
</html>
